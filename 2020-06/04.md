# 学习 浏览器工作原理与实践

## 29 | HTTP/2：如何提升网络速度？

### HTTP/1.1 的主要问题

对带宽的利用率却并不理想

主要是由以下三个原因导致:

1. TCP 的慢启动。
2. 同时开启了多条 TCP 连接，这些连接会竞争固定的带宽。
3. HTTP/1.1 队头阻塞的问题。

### HTTP/2 的多路复用

方案：一个域名只使用一个 TCP 长连接和消除队头阻塞问题。

HTTP/2 的多路复用：

![avatar](../image/http2duolu.png)

### 多路复用的实现

HTTP/2 协议栈:

![avatar](../image/http2xieyizhan.png)

HTTP/2 的请求和接收过程:

1. 浏览器准备好请求数据，包括了请求行、请求头等信息，如果是 POST 方法，还要有请求体。
2. 数据经过二进制分帧层处理之后，会被转换为一个个带有请求 ID 编号的帧，通过协议栈将这些帧发送给服务器。
3. 服务器接收到所有帧之后，会将所有相同 ID 的帧合并为一条完整的请求信息。
4. 服务器处理该条请求，并将处理的响应行、响应头和响应体分别发送至二进制分帧层。
5. 二进制分帧层会将这些响应数据转换为一个个带有请求 ID 编号的帧，经过协议栈发送给浏览器。
6. 浏览器接收到响应帧之后，会根据 ID 编号将帧的数据提交给对应的请求。

### HTTP/2 其他特性

1. 可以设置请求的优先级
2. 服务器推送
3. 头部压缩
