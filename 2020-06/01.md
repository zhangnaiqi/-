# 学习 浏览器工作原理与实践

## 26 | 虚拟 DOM：虚拟 DOM 和实际的 DOM 有何不同？

### 什么是虚拟 DOM

#### DOM 存在问题

1. 对 DOM 进行操作时往往会引起重排、重绘
2. 编写不当的代码操作 DOM 还会引起强制布局和布局抖动
3. 复杂的页面往往会频繁的操作 DOM

#### 虚拟 DOM 到底要解决的事情：

1. 将页面改变的内容应用到虚拟 DOM 上，不直接应用到 DOM 上。
2. 变化被应用到虚拟 DOM 上时，虚拟 DOM 并不急着去渲染页面，而是调整虚 DOM 的内部状态，这样操作虚拟 DOM 的就变得非常轻了。
3. 在虚拟 DOM 收集到足够的改变时，再把这些变化一次性应用到真实的 DOM 上。

#### 虚拟 DOM 执行流程

![avatar](../image/vmDOM.png)

1. 创建阶段。首先依据 JSX 和基础数据创建出来虚拟 DOM，它反映了真实的 DOM 树的结构。然后由虚拟 DOM 树创建出真实 DOM 树，真实的 DOM 树生成完后，再触发渲染流水线往屏幕输出页面。
2. 更新阶段。如果数据发生了改变，那么就需要根据新的数据创建一个新的虚拟 DOM 树；然后 React 比较两个树，找出变化的地方，并把变化的地方一次性更新到真实的 DOM 树上；最后渲染引擎更新渲染流水线，并生成新的页面。

### MVC 模型虚拟 DOM

#### 1. 双缓存

先将计算的中间结果存放在另一个缓冲区中，等全部的计算结束，缓冲区已经存储了完整的图形之后，再将缓冲区的图形数据一次性复制到显示缓冲区，就使得整个图像的输出非常稳定。

#### 2. MVC 模式

![avatar](../image/MVCjiegou.png)

由模型、视图和控制器组成，核心思想就是将数据和视图分离，也就是视图和模型之间是不允许直接通信的，它们之间的通信都是通过控制器来完成的。

### 虚拟 DOM 解决问题

1. 频繁更新 dom 引起的性能问题；
2. 将真实 DOM 和 js 操作解耦，减少 js 操作 dom 复杂性。
