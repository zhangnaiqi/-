# 学习 浏览器工作原理与实践

## 31 ｜ HTTP/3：甩掉 TCP、TLS 的包袱，构建高效网络

### TCP 的队头阻塞

在 TCP 传输过程中，由于单个数据包的丢失而造成的阻塞称为 TCP 上的队头阻塞。

### TCP 建立连接的延时

在传输数据之前，需要花掉 3 ～ 4 个 RTT（网络延迟）。浏览器和服务器的物理距离较近， 1 个 RTT 的时间可能在 10 毫秒以内，也就是总共要消耗掉 30 ～ 40 毫秒。这个时间也许用户还可以接受，但如果服务器相隔较远， 1 个 RTT 就可能需要 100 毫秒以上了，这种情况下整个握手过程需要 300 ～ 400 毫秒，这时用户就能明显地感受到“慢”了。

### TCP 协议僵化

我们是不是可以通过改进 TCP 协议来解决这些问题呢？非常困难。主要有两个原因：

1. 第一个是中间设备(路由器、防火墙、NAT、交换机)的僵化。老设备不支持
2. 操作系统（TCP 协议都是通过操作系统内核来实现的，应用程序只能使用不能修改。操作系统的更新都滞后于软件的更新，因此要想自由地更新内核中的 TCP 协议也是非常困难的）

### QUIC 协议

HTTP/2 和 HTTP/3 协议栈:

![avatar](../image/http3xy.png)

QUIC 协议,几点功能:

1. 实现了类似 TCP 的流量控制、传输可靠性的功能。
2. 集成了 TLS 加密功能.
3. 实现了 HTTP/2 中的多路复用功能。

### HTTP/3 的挑战

1. 服务器和浏览器端都没有对 HTTP/3 提供比较完整的支持。
2. 部署 HTTP/3 也存在着非常大的问题。因为系统内核对 UDP 的优化远远没有达到 TCP 的优化程度，这也是阻碍 QUIC 的一个重要原因。
3. 中间设备僵化的问题。这些设备对 UDP 的优化程度远远低于 TCP，据统计使用 QUIC 协议时，大约有 3%～ 7% 的丢包率。
